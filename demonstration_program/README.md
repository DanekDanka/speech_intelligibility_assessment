# Демонстрационная программа для модели предсказания STOI

Веб-приложение на Gradio для демонстрации работы CNN модели предсказания STOI (Speech Transmission Objective Intelligibility).

## Описание

Программа позволяет:
- Записывать голос через микрофон или загружать аудио файлы
- Автоматически разделять аудио на 5-секундные отрезки с шагом 1 секунда
- Предсказывать значения STOI для каждого отрезка
- Визуализировать результаты на графиках

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что у вас есть обученная модель. По умолчанию программа ищет модель по пути:
   - `../checkpoints_cnn_final/best_cnn_final.pt`

   Или вы можете указать свой путь через переменную окружения:
```bash
export MODEL_CHECKPOINT=/path/to/your/model.pt
```

## Запуск

### Вариант 1: Использование скрипта (рекомендуется)
```bash
./run.sh
```

### Вариант 2: Прямой запуск
```bash
python app.py
```

### Вариант 3: С указанием пути к модели
```bash
export MODEL_CHECKPOINT=../checkpoints_cnn_hyperopt_v2/best_cnn_hyperopt.pt
python app.py
```

После запуска откройте браузер и перейдите по адресу, который будет показан в консоли (обычно `http://localhost:7860`).

## Использование

1. **Запись аудио:**
   - Нажмите кнопку "Записать аудио"
   - Произнесите несколько секунд речи (рекомендуется минимум 5 секунд)
   - Остановите запись

2. **Загрузка файла:**
   - Нажмите "Upload" и выберите аудио файл (WAV, MP3 и т.д.)

3. **Обработка:**
   - Нажмите кнопку "Обработать аудио" или аудио обработается автоматически после загрузки
   - Результаты появятся ниже:
     - График значений STOI по времени
     - Среднее значение STOI
     - Мел-спектр с наложенными значениями STOI (цвет показывает качество)

## Параметры обработки

- **Длительность чанка:** 5 секунд
- **Шаг между чанками:** 1 секунда
- **Частота дискретизации:** 16000 Hz

## Структура результатов

1. **График STOI:** Показывает предсказанные значения STOI для каждого временного отрезка
2. **Среднее значение:** Общая оценка разборчивости речи
3. **Мел-спектр:** Визуализация частотного спектра с наложенными значениями STOI (цветовая индикация)

## Примечания

- Модель работает лучше всего с чистой речью без сильных шумов
- Рекомендуется записывать в тихой обстановке с хорошим микрофоном
- Минимальная длительность аудио: 5 секунд
- Поддерживаются форматы: WAV, MP3, FLAC и другие, поддерживаемые librosa

## Устранение неполадок

**Ошибка "Чекпоинт не найден":**
- Убедитесь, что путь к модели указан правильно
- Проверьте переменную окружения `MODEL_CHECKPOINT`

**Ошибка при загрузке модели:**
- Убедитесь, что версия PyTorch совместима с сохраненной моделью
- Проверьте, что все зависимости установлены

**Проблемы с микрофоном:**
- Убедитесь, что микрофон подключен и разрешения на доступ предоставлены
- Попробуйте использовать загрузку файла вместо записи
